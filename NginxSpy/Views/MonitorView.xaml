<UserControl x:Class="NginxSpy.Views.MonitorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:models="clr-namespace:NginxSpy.Models">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">
            <!-- 页面标题 -->
            <TextBlock Text="实时监控" Style="{StaticResource TitleTextStyle}" />

            <!-- 统计卡片区域 -->
            <Grid Margin="0,0,0,24">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- 运行中进程数 -->
                <materialDesign:Card Grid.Column="0" Style="{StaticResource StatusCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                            <materialDesign:PackIcon Kind="Play" Width="24" Height="24" 
                                                   Foreground="{StaticResource SuccessBrush}" 
                                                   VerticalAlignment="Center" Margin="0,0,8,0" />
                            <TextBlock Text="运行中" FontWeight="Medium" VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Text="{Binding RunningProcessCount}" Style="{StaticResource StatisticNumberStyle}" 
                                 Foreground="{StaticResource SuccessBrush}" />
                        <TextBlock Text="个进程" Style="{StaticResource StatisticLabelStyle}" />
                    </StackPanel>
                </materialDesign:Card>

                <!-- 总进程数 -->
                <materialDesign:Card Grid.Column="1" Style="{StaticResource StatusCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                            <materialDesign:PackIcon Kind="Application" Width="24" Height="24" 
                                                   Foreground="{StaticResource AccentBrush}" 
                                                   VerticalAlignment="Center" Margin="0,0,8,0" />
                            <TextBlock Text="总数" FontWeight="Medium" VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Text="{Binding TotalProcessCount}" Style="{StaticResource StatisticNumberStyle}" />
                        <TextBlock Text="个实例" Style="{StaticResource StatisticLabelStyle}" />
                    </StackPanel>
                </materialDesign:Card>

                <!-- CPU使用率 -->
                <materialDesign:Card Grid.Column="2" Style="{StaticResource StatusCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                            <materialDesign:PackIcon Kind="Cpu64Bit" Width="24" Height="24" 
                                                   Foreground="{StaticResource WarningBrush}" 
                                                   VerticalAlignment="Center" Margin="0,0,8,0" />
                            <TextBlock Text="CPU" FontWeight="Medium" VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Text="{Binding TotalCpuUsage, StringFormat='{}{0:F1}%'}" 
                                 Style="{StaticResource StatisticNumberStyle}" 
                                 Foreground="{StaticResource WarningBrush}" />
                        <TextBlock Text="使用率" Style="{StaticResource StatisticLabelStyle}" />
                    </StackPanel>
                </materialDesign:Card>

                <!-- 内存使用量 -->
                <materialDesign:Card Grid.Column="3" Style="{StaticResource StatusCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                            <materialDesign:PackIcon Kind="Memory" Width="24" Height="24" 
                                                   Foreground="{StaticResource DangerBrush}" 
                                                   VerticalAlignment="Center" Margin="0,0,8,0" />
                            <TextBlock Text="内存" FontWeight="Medium" VerticalAlignment="Center" />
                        </StackPanel>
                        <TextBlock Text="{Binding TotalMemoryUsage, StringFormat='{}{0:F0} MB'}" 
                                 Style="{StaticResource StatisticNumberStyle}" 
                                 Foreground="{StaticResource DangerBrush}" />
                        <TextBlock Text="使用量" Style="{StaticResource StatisticLabelStyle}" />
                    </StackPanel>
                </materialDesign:Card>
            </Grid>

            <!-- 快速操作区域 -->
            <materialDesign:Card Style="{StaticResource StatusCardStyle}" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="快速操作" Style="{StaticResource SubtitleTextStyle}" />
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button Content="启动全部" 
                                Style="{StaticResource SuccessButtonStyle}"
                                Command="{Binding StartAllCommand}">
                            <Button.ToolTip>
                                <ToolTip Content="启动所有已停止的nginx进程" />
                            </Button.ToolTip>
                        </Button>
                        
                        <Button Content="停止全部" 
                                Style="{StaticResource DangerButtonStyle}"
                                Command="{Binding StopAllCommand}">
                            <Button.ToolTip>
                                <ToolTip Content="停止所有正在运行的nginx进程" />
                            </Button.ToolTip>
                        </Button>
                        
                        <Button Content="重启全部" 
                                Style="{StaticResource WarningButtonStyle}"
                                Command="{Binding RestartAllCommand}">
                            <Button.ToolTip>
                                <ToolTip Content="重启所有nginx进程" />
                            </Button.ToolTip>
                        </Button>
                        
                        <Button Content="刷新" 
                                Style="{StaticResource PrimaryButtonStyle}"
                                Command="{Binding RefreshCommand}">
                            <Button.ToolTip>
                                <ToolTip Content="手动刷新监控数据" />
                            </Button.ToolTip>
                        </Button>
                        
                        <ToggleButton IsChecked="{Binding IsMonitoring}" 
                                    Style="{StaticResource MaterialDesignSwitchToggleButton}"
                                    Command="{Binding ToggleMonitoringCommand}"
                                    Margin="16,0,0,0">
                            <ToggleButton.ToolTip>
                                <ToolTip Content="开启/关闭自动监控" />
                            </ToggleButton.ToolTip>
                        </ToggleButton>
                        <TextBlock Text="自动监控" VerticalAlignment="Center" Margin="8,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </materialDesign:Card>

            <!-- 进程列表 -->
            <materialDesign:Card Style="{StaticResource StatusCardStyle}">
                <StackPanel>
                    <TextBlock Text="Nginx实例列表" Style="{StaticResource SubtitleTextStyle}" />
                    
                    <DataGrid ItemsSource="{Binding NginxInstances}" 
                              Style="{StaticResource ProcessDataGridStyle}"
                              MaxHeight="400">
                        <DataGrid.Columns>
                            <!-- 状态指示器 -->
                            <DataGridTemplateColumn Header="状态" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Ellipse Width="12" Height="12" Margin="0,0,8,0">
                                                <Ellipse.Style>
                                                    <Style TargetType="Ellipse">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Status}" Value="{x:Static models:NginxStatus.Running}">
                                                                <Setter Property="Fill" Value="{StaticResource SuccessBrush}" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="{x:Static models:NginxStatus.Stopped}">
                                                                <Setter Property="Fill" Value="{StaticResource DangerBrush}" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="{x:Static models:NginxStatus.Starting}">
                                                                <Setter Property="Fill" Value="{StaticResource WarningBrush}" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Status}" Value="{x:Static models:NginxStatus.Stopping}">
                                                                <Setter Property="Fill" Value="{StaticResource WarningBrush}" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Ellipse.Style>
                                            </Ellipse>
                                            <TextBlock Text="{Binding Status}" FontSize="12" />
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <!-- 实例名称 -->
                            <DataGridTextColumn Header="名称" Binding="{Binding Name}" Width="150" />
                            
                            <!-- 进程ID -->
                            <DataGridTextColumn Header="进程ID" Binding="{Binding ProcessId}" Width="80" />
                            
                            <!-- CPU使用率 -->
                            <DataGridTextColumn Header="CPU(%)" Binding="{Binding CpuUsage, StringFormat='{}{0:F1}'}" Width="80" />
                            
                            <!-- 内存使用量 -->
                            <DataGridTextColumn Header="内存(MB)" Binding="{Binding MemoryUsage, StringFormat='{}{0:F0}'}" Width="100" />
                            
                            <!-- 运行时长 -->
                            <DataGridTemplateColumn Header="运行时长" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding RunningTime, StringFormat='{}{0:hh\\:mm\\:ss}'}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            
                            <!-- 配置文件路径 -->
                            <DataGridTextColumn Header="配置文件" Binding="{Binding ConfigPath}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </materialDesign:Card>
        </StackPanel>
    </ScrollViewer>
</UserControl>