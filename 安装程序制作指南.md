# NginxSpy å®‰è£…ç¨‹åºåˆ¶ä½œæŒ‡å—

## ğŸ“¦ æ¦‚è¿°

æ˜¯çš„ï¼Œå®Œå…¨å¯ä»¥ä¸ºNginxSpyåˆ¶ä½œä¸“ä¸šçš„EXEå®‰è£…ç¨‹åºåŒ…ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆæ¡Œé¢å¿«æ·æ–¹å¼ã€‚æœ¬æŒ‡å—å°†ä»‹ç»å‡ ç§ä¸»æµçš„å®‰è£…ç¨‹åºåˆ¶ä½œæ–¹æ¡ˆã€‚

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šInno Setupï¼ˆæ¨èï¼‰â­

**ä¼˜åŠ¿ï¼š**
- å®Œå…¨å…è´¹ä¸”å¼€æº
- åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒç°ä»£å®‰è£…ç¨‹åºç‰¹æ€§
- å­¦ä¹ æ›²çº¿ç›¸å¯¹å¹³ç¼“
- ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£ä¸°å¯Œ
- æ”¯æŒè‡ªå®šä¹‰ç•Œé¢å’Œè„šæœ¬
- å¯ä»¥åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼ã€å¼€å§‹èœå•é¡¹
- æ”¯æŒè‡ªåŒ…å«.NETåº”ç”¨ç¨‹åº

**é€‚ç”¨åœºæ™¯ï¼š** ä¸­å°å‹åº”ç”¨ç¨‹åºï¼Œéœ€è¦çµæ´»å®šåˆ¶çš„å®‰è£…ç¨‹åº

### æ–¹æ¡ˆäºŒï¼šWiX Toolset

**ä¼˜åŠ¿ï¼š**
- å¾®è½¯å®˜æ–¹æ”¯æŒ
- ç”Ÿæˆæ ‡å‡†MSIå®‰è£…åŒ…
- ä¼ä¸šçº§åŠŸèƒ½æ”¯æŒ
- ä¸Visual Studioé›†æˆ
- æ”¯æŒå¤æ‚çš„å®‰è£…é€»è¾‘

**åŠ£åŠ¿ï¼š**
- å­¦ä¹ æ›²çº¿é™¡å³­
- XMLé…ç½®å¤æ‚
- æ–‡æ¡£ç›¸å¯¹ç¨€å°‘

**é€‚ç”¨åœºæ™¯ï¼š** ä¼ä¸šçº§åº”ç”¨ç¨‹åºï¼Œéœ€è¦MSIæ ¼å¼çš„å®‰è£…åŒ…

### æ–¹æ¡ˆä¸‰ï¼šMSIXï¼ˆç°ä»£åŒ–æ–¹æ¡ˆï¼‰

**ä¼˜åŠ¿ï¼š**
- å¾®è½¯æ¨èçš„ç°ä»£å®‰è£…æ ¼å¼
- æ”¯æŒè‡ªåŠ¨æ›´æ–°
- æ²™ç›’åŒ–å®‰è£…
- å¯é€šè¿‡Microsoft Storeåˆ†å‘

**åŠ£åŠ¿ï¼š**
- ä»…æ”¯æŒWindows 10 1709+
- åŠŸèƒ½é™åˆ¶è¾ƒå¤š
- ä¸é€‚åˆä¼ ç»Ÿæ¡Œé¢åº”ç”¨

## ğŸš€ Inno Setup å®æ–½æŒ‡å—

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡è‡ªåŒ…å«å‘å¸ƒç‰ˆæœ¬

```bash
# å‘å¸ƒè‡ªåŒ…å«çš„Windows x64ç‰ˆæœ¬
dotnet publish -c Release -r win-x64 --self-contained true -p:PublishSingleFile=true

# æˆ–è€…å‘å¸ƒæ¡†æ¶ä¾èµ–ç‰ˆæœ¬ï¼ˆéœ€è¦ç”¨æˆ·å®‰è£….NET 8ï¼‰
dotnet publish -c Release -r win-x64 --self-contained false
```

### ç¬¬äºŒæ­¥ï¼šå®‰è£…Inno Setup

1. ä¸‹è½½Inno Setupï¼šhttps://jrsoftware.org/isinfo.php
2. å®‰è£…åˆ°ç³»ç»Ÿï¼ˆå…è´¹ï¼‰
3. å¯åŠ¨Inno Setup Compiler

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå®‰è£…è„šæœ¬

åˆ›å»º `NginxSpy-Setup.iss` æ–‡ä»¶ï¼š

```pascal
[Setup]
AppName=NginxSpy
AppVersion=1.0.0
AppPublisher=Your Company Name
AppPublisherURL=https://your-website.com
AppSupportURL=https://your-website.com/support
AppUpdatesURL=https://your-website.com/updates
DefaultDirName={autopf}\NginxSpy
DefaultGroupName=NginxSpy
AllowNoIcons=yes
LicenseFile=LICENSE.txt
OutputDir=installer
OutputBaseFilename=NginxSpy-Setup-v1.0.0
SetupIconFile=NginxSpy\Resources\app-icon.ico
Compression=lzma
SolidCompression=yes
WizardStyle=modern
PrivilegesRequired=lowest
ArchitecturesAllowed=x64
ArchitecturesInstallIn64BitMode=x64

[Languages]
Name: "english"; MessagesFile: "compiler:Default.isl"
Name: "chinesesimplified"; MessagesFile: "compiler:Languages\ChineseSimplified.isl"

[Tasks]
Name: "desktopicon"; Description: "{cm:CreateDesktopIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked
Name: "quicklaunchicon"; Description: "{cm:CreateQuickLaunchIcon}"; GroupDescription: "{cm:AdditionalIcons}"; Flags: unchecked; OnlyBelowVersion: 6.1

[Files]
; ä¸»ç¨‹åºæ–‡ä»¶
Source: "NginxSpy\bin\Release\net8.0-windows\win-x64\publish\*"; DestDir: "{app}"; Flags: ignoreversion recursesubdirs createallsubdirs
; ç”¨æˆ·æ–‡æ¡£
Source: "ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ.md"; DestDir: "{app}\docs"; Flags: ignoreversion
Source: "æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ.md"; DestDir: "{app}\docs"; Flags: ignoreversion
Source: "README.md"; DestDir: "{app}\docs"; Flags: ignoreversion

[Icons]
; å¼€å§‹èœå•å¿«æ·æ–¹å¼
Name: "{group}\NginxSpy"; Filename: "{app}\NginxSpy.exe"; IconFilename: "{app}\NginxSpy.exe"
Name: "{group}\ç”¨æˆ·æ‰‹å†Œ"; Filename: "{app}\docs\ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ.md"
Name: "{group}\{cm:UninstallProgram,NginxSpy}"; Filename: "{uninstallexe}"
; æ¡Œé¢å¿«æ·æ–¹å¼
Name: "{autodesktop}\NginxSpy"; Filename: "{app}\NginxSpy.exe"; Tasks: desktopicon; IconFilename: "{app}\NginxSpy.exe"
; å¿«é€Ÿå¯åŠ¨æ å¿«æ·æ–¹å¼
Name: "{userappdata}\Microsoft\Internet Explorer\Quick Launch\NginxSpy"; Filename: "{app}\NginxSpy.exe"; Tasks: quicklaunchicon

[Run]
; å®‰è£…å®Œæˆåè¿è¡Œç¨‹åº
Filename: "{app}\NginxSpy.exe"; Description: "{cm:LaunchProgram,NginxSpy}"; Flags: nowait postinstall skipifsilent

[UninstallDelete]
; æ¸…ç†ç”¨æˆ·æ•°æ®ï¼ˆå¯é€‰ï¼‰
Type: filesandordirs; Name: "{userappdata}\NginxSpy"

[Code]
// æ£€æŸ¥æ˜¯å¦å·²å®‰è£….NET 8ï¼ˆå¦‚æœä½¿ç”¨æ¡†æ¶ä¾èµ–ç‰ˆæœ¬ï¼‰
function IsDotNet8Installed(): Boolean;
var
  Success: Boolean;
  InstallPath: String;
begin
  Success := RegQueryStringValue(HKLM, 'SOFTWARE\dotnet\Setup\InstalledVersions\x64\sharedhost', 'Version', InstallPath);
  Result := Success and (CompareVersion(InstallPath, '8.0.0') >= 0);
end;

// å®‰è£…å‰æ£€æŸ¥
function InitializeSetup(): Boolean;
begin
  Result := True;
  // å¦‚æœä½¿ç”¨æ¡†æ¶ä¾èµ–ç‰ˆæœ¬ï¼Œå–æ¶ˆæ³¨é‡Šä»¥ä¸‹ä»£ç 
  (*
  if not IsDotNet8Installed() then
  begin
    MsgBox('æ­¤åº”ç”¨ç¨‹åºéœ€è¦ .NET 8 è¿è¡Œæ—¶ã€‚è¯·å…ˆå®‰è£… .NET 8 Desktop Runtimeã€‚', mbError, MB_OK);
    Result := False;
  end;
  *)
end;
```

### ç¬¬å››æ­¥ï¼šç¼–è¯‘å®‰è£…ç¨‹åº

1. åœ¨Inno Setup Compilerä¸­æ‰“å¼€ `NginxSpy-Setup.iss`
2. ç‚¹å‡» "Compile" æŒ‰é’®
3. ç”Ÿæˆçš„å®‰è£…ç¨‹åºä½äº `installer` ç›®å½•

## ğŸ› ï¸ WiX Toolset å®æ–½æŒ‡å—

### å®‰è£…WiX Toolset

```bash
# å®‰è£…WiXå·¥å…·
dotnet tool install --global wix

# æˆ–é€šè¿‡Visual Studioæ‰©å±•å®‰è£…
```

### åˆ›å»ºWiXé¡¹ç›®

1. åœ¨è§£å†³æ–¹æ¡ˆä¸­æ·»åŠ æ–°çš„WiXé¡¹ç›®
2. é…ç½®Product.wxsæ–‡ä»¶
3. ä½¿ç”¨Heatå·¥å…·ç”Ÿæˆæ–‡ä»¶æ¸…å•
4. ç¼–è¯‘ç”ŸæˆMSIå®‰è£…åŒ…

## ğŸ“‹ è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬

åˆ›å»º `Build-Installer.ps1` è„šæœ¬ï¼š

```powershell
# NginxSpy å®‰è£…ç¨‹åºæ„å»ºè„šæœ¬

param(
    [string]$Version = "1.0.0",
    [string]$Configuration = "Release"
)

$ErrorActionPreference = "Stop"

Write-Host "å¼€å§‹æ„å»º NginxSpy å®‰è£…ç¨‹åº..." -ForegroundColor Green

# 1. æ¸…ç†è¾“å‡ºç›®å½•
Write-Host "æ¸…ç†è¾“å‡ºç›®å½•..." -ForegroundColor Yellow
if (Test-Path "installer") {
    Remove-Item "installer" -Recurse -Force
}
New-Item -ItemType Directory -Path "installer" -Force | Out-Null

# 2. å‘å¸ƒåº”ç”¨ç¨‹åº
Write-Host "å‘å¸ƒè‡ªåŒ…å«åº”ç”¨ç¨‹åº..." -ForegroundColor Yellow
dotnet publish NginxSpy\NginxSpy.csproj -c $Configuration -r win-x64 --self-contained true -p:PublishSingleFile=true -p:Version=$Version

if ($LASTEXITCODE -ne 0) {
    Write-Error "åº”ç”¨ç¨‹åºå‘å¸ƒå¤±è´¥"
    exit 1
}

# 3. æ£€æŸ¥Inno Setup
$InnoSetupPath = "${env:ProgramFiles(x86)}\Inno Setup 6\ISCC.exe"
if (-not (Test-Path $InnoSetupPath)) {
    Write-Error "æœªæ‰¾åˆ° Inno Setupï¼Œè¯·å…ˆå®‰è£… Inno Setup 6"
    exit 1
}

# 4. ç¼–è¯‘å®‰è£…ç¨‹åº
Write-Host "ç¼–è¯‘å®‰è£…ç¨‹åº..." -ForegroundColor Yellow
& $InnoSetupPath "NginxSpy-Setup.iss" /DAppVersion=$Version

if ($LASTEXITCODE -ne 0) {
    Write-Error "å®‰è£…ç¨‹åºç¼–è¯‘å¤±è´¥"
    exit 1
}

Write-Host "å®‰è£…ç¨‹åºæ„å»ºå®Œæˆï¼" -ForegroundColor Green
Write-Host "è¾“å‡ºæ–‡ä»¶ï¼šinstaller\NginxSpy-Setup-v$Version.exe" -ForegroundColor Cyan
```

## ğŸ¨ é«˜çº§åŠŸèƒ½

### è‡ªå®šä¹‰å®‰è£…ç•Œé¢

- æ·»åŠ è‡ªå®šä¹‰æ¬¢è¿é¡µé¢
- é›†æˆè®¸å¯åè®®
- è‡ªå®šä¹‰å®‰è£…é€‰é¡¹
- æ·»åŠ å®‰è£…è¿›åº¦åŠ¨ç”»

### è‡ªåŠ¨æ›´æ–°æ”¯æŒ

- é›†æˆSquirrel.Windows
- å®ç°åº”ç”¨å†…æ›´æ–°æ£€æŸ¥
- æ”¯æŒå¢é‡æ›´æ–°

### æ•°å­—ç­¾å

```bash
# ä½¿ç”¨ä»£ç ç­¾åè¯ä¹¦ç­¾åå®‰è£…ç¨‹åº
signtool sign /f "certificate.pfx" /p "password" /t "http://timestamp.digicert.com" "NginxSpy-Setup.exe"
```

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | Inno Setup | WiX Toolset | MSIX |
|------|------------|-------------|------|
| å­¦ä¹ éš¾åº¦ | ç®€å• | å›°éš¾ | ä¸­ç­‰ |
| è‡ªå®šä¹‰ç¨‹åº¦ | é«˜ | å¾ˆé«˜ | ä½ |
| æ–‡ä»¶å¤§å° | å° | ä¸­ç­‰ | å¤§ |
| ç³»ç»Ÿå…¼å®¹æ€§ | å¹¿æ³› | å¹¿æ³› | é™åˆ¶ |
| ä¼ä¸šéƒ¨ç½² | æ”¯æŒ | ä¼˜ç§€ | ä¼˜ç§€ |
| å¼€å‘æˆæœ¬ | ä½ | é«˜ | ä¸­ç­‰ |

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™é—®é¢˜**ï¼šä½¿ç”¨ `PrivilegesRequired=lowest` é¿å…éœ€è¦ç®¡ç†å‘˜æƒé™
2. **æ–‡ä»¶è·¯å¾„**ï¼šç¡®ä¿æ‰€æœ‰æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„
3. **å›¾æ ‡æ˜¾ç¤º**ï¼šç¡®ä¿ICOæ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ŒåŒ…å«å¤šç§å°ºå¯¸
4. **å¸è½½æ¸…ç†**ï¼šæ­£ç¡®é…ç½®å¸è½½æ—¶çš„æ–‡ä»¶æ¸…ç†

### è°ƒè¯•æŠ€å·§

- ä½¿ç”¨Inno Setupçš„è°ƒè¯•æ¨¡å¼
- æ£€æŸ¥å®‰è£…æ—¥å¿—æ–‡ä»¶
- æµ‹è¯•ä¸åŒWindowsç‰ˆæœ¬çš„å…¼å®¹æ€§

## ğŸ“ æ€»ç»“

æ¨èä½¿ç”¨ **Inno Setup** ä½œä¸ºNginxSpyçš„å®‰è£…ç¨‹åºåˆ¶ä½œå·¥å…·ï¼Œå› ä¸ºå®ƒï¼š

âœ… å®Œå…¨å…è´¹ä¸”åŠŸèƒ½å¼ºå¤§  
âœ… å­¦ä¹ æˆæœ¬ä½ï¼Œæ–‡æ¡£ä¸°å¯Œ  
âœ… æ”¯æŒç°ä»£å®‰è£…ç¨‹åºç‰¹æ€§  
âœ… å¯ä»¥è½»æ¾åˆ›å»ºæ¡Œé¢å¿«æ·æ–¹å¼  
âœ… æ”¯æŒè‡ªåŒ…å«.NETåº”ç”¨ç¨‹åº  
âœ… ç”Ÿæˆçš„å®‰è£…ç¨‹åºä½“ç§¯å°ä¸”å…¼å®¹æ€§å¥½  

æŒ‰ç…§æœ¬æŒ‡å—çš„æ­¥éª¤ï¼Œæ‚¨å¯ä»¥ä¸ºNginxSpyåˆ›å»ºä¸“ä¸šçš„Windowså®‰è£…ç¨‹åºï¼Œæä¾›è‰¯å¥½çš„ç”¨æˆ·å®‰è£…ä½“éªŒã€‚